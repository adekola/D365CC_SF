(()=>{"use strict";(()=>{class e{constructor(){this.conversationStartTimes={},this.callerNumbers={}}initialize(){if(void 0===window.sforce||void 0===window.sforce.opencti){const o="/support/api/54.0/lightning/opencti.js",t=`${new URL(document.referrer).origin}${o}`;return e.loadScript(t)}return Promise.resolve(!0)}bindEvents(){const e=window.Microsoft.CCaaS.EmbedSDK;e&&(e.onConversationLoaded(e=>{const{liveWorkItemId:o,customer:t}=e;this.conversationStartTimes[o]=new Date,this.callerNumbers[o]=(null==t?void 0:t.phoneNumber)||""}),e.onStatusChange(e=>{const{liveWorkItemId:o,status:t}=e;if("WrapUp"===t||"Close"===t){const e=this.conversationStartTimes[o];if(!e)return void console.warn(`No start time found for conversation ${o}`);const t=new Date,r={subject:"Call Summary",callType:"Inbound",callDurationInSeconds:Math.floor((t.getTime()-e.getTime())/1e3),whoId:this.callerNumbers[o]||"",entityApiName:"Case",id:""};window.sforce.opencti.saveLog({value:r,callback:e=>{e.success?(console.log("Call log saved successfully:",e),delete this.conversationStartTimes[o],delete this.callerNumbers[o]):console.error("Failed to save call log:",e.errors||"An unknown error occurred.")}})}}))}static loadScript(e){return new Promise((o,t)=>{const r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=function(){o(!0)},r.onerror=function(){t(new Error(`Error in loading ${e}`))},document.getElementsByTagName("head")[0].appendChild(r)})}}window.CCaaS=window.CCaaS||{},window.CCaaS.CTIDriver||(window.CCaaS.CTIDriver=e)})()})();
