(()=>{"use strict";(()=>{class e{constructor(){this.conversationStartTimes={},this.callerNumbers={}}initialize(){if(void 0===window.sforce||void 0===window.sforce.opencti){const o="/support/api/54.0/lightning/opencti.js",t=`${new URL(document.referrer).origin}${o}`;return e.loadScript(t)}return Promise.resolve(!0)}bindEvents(){var e,o;const t=null===(o=null===(e=window.Microsoft)||void 0===e?void 0:e.CCaaS)||void 0===o?void 0:o.EmbedSDK;t&&(t.conversation.onConversationLoaded(e=>{console.log("Conversation loaded:",e),console.log("Available properties:",Object.keys(e)),console.log("customerPhoneNumber:",e.customerPhoneNumber),console.log("customerName:",e.customerName);const{liveWorkItemId:o,customerPhoneNumber:t}=e;console.log(e),this.conversationStartTimes[o]=new Date,this.callerNumbers[o]=t||"",console.log("Stored phone number:",this.callerNumbers[o])}),t.conversation.onStatusChange(e=>{const{liveWorkItemId:o,statusCode:t}=e;if(console.log("Status update received:",e),console.log(`Status code for liveWorkItemId ${o}:`,t),5===t||4===t){const e=this.conversationStartTimes[o],t=new Date,n=Math.floor((t.getTime()-e.getTime())/1e3),r=this.callerNumbers[o],s="",a={Subject:"Call Summary",callType:"Inbound",Call_Duration__c:n,Call_Start_Time__c:e.toISOString(),Call_End_Time__c:t.toISOString(),ContactPhone:r,entityApiName:"Case",CaseNumber:s};console.log("Log data to be saved:",a),window.sforce.opencti.saveLog({value:a,callback:e=>{e.success?console.log("Log saved successfully:",e):console.error("Failed to save log:",e.errors||"An unknown error occurred.")}})}}))}static loadScript(e){return new Promise((o,t)=>{const n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=function(){o(!0)},n.onerror=function(){t(new Error(`Error in loading ${e}`))},document.getElementsByTagName("head")[0].appendChild(n)})}}window.CCaaS=window.CCaaS||{},window.CCaaS.CTIDriver||(window.CCaaS.CTIDriver=e)})()})();
