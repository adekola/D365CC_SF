(()=>{"use strict";(()=>{class o{constructor(){this.conversationStartTimes={},this.callerNumbers={}}initialize(){if(void 0===window.sforce||void 0===window.sforce.opencti){const e="/support/api/54.0/lightning/opencti.js",t=`${new URL(document.referrer).origin}${e}`;return o.loadScript(t)}return Promise.resolve(!0)}bindEvents(){var o,e;const t=null===(e=null===(o=window.Microsoft)||void 0===o?void 0:o.CCaaS)||void 0===e?void 0:e.EmbedSDK;t&&(t.conversation.onConversationLoaded(o=>{console.log("Conversation loaded:",o),console.log("Available properties:",Object.keys(o)),console.log("customerPhoneNumber:",o.customerPhoneNumber),console.log("customerName:",o.customerName);const{liveWorkItemId:e,customerPhoneNumber:t}=o;console.log(o),this.conversationStartTimes[e]=new Date,this.callerNumbers[e]=t||"",console.log("Stored phone number:",this.callerNumbers[e])}),t.conversation.onStatusChange(o=>{const{liveWorkItemId:e,statusCode:t}=o;if(console.log("Status update received:",o),console.log(`Status code for liveWorkItemId ${e}:`,t),5===t||4===t){const o=this.conversationStartTimes[e],t=new Date,n=Math.floor((t.getTime()-o.getTime())/1e3),r=this.callerNumbers[e],s={Subject:`Call Summary - ${r||"Unknown"}`,TaskSubtype:"Call",CallType:"Inbound",CallDurationInSeconds:n,Phone:r,ActivityDate:(new Date).toISOString().split("T")[0],Status:"Completed",Priority:"Normal",Call_Start_Time__c:o.toISOString(),Call_End_Time__c:t.toISOString(),Description:`Inbound call from ${r||"Unknown number"}\nDuration: ${n} seconds\nStart: ${o.toLocaleString()}\nEnd: ${t.toLocaleString()}`,entityApiName:"Task"};console.log("Task log data to be saved:",s),window.sforce.opencti.saveLog({value:s,callback:o=>{o.success?console.log("Task logged successfully:",o):console.error("Failed to save task:",o.errors||"An unknown error occurred.")}})}}))}static loadScript(o){return new Promise((e,t)=>{const n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=o,n.onload=function(){e(!0)},n.onerror=function(){t(new Error(`Error in loading ${o}`))},document.getElementsByTagName("head")[0].appendChild(n)})}}window.CCaaS=window.CCaaS||{},window.CCaaS.CTIDriver||(window.CCaaS.CTIDriver=o)})()})();
